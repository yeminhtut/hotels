<?phpfunction _forgot_password(){	$content = array();	  // If already login or just login/sign up via facebook, redirect away  $user = User::getUser();  if($user)    redirect('user/profile');    if(isset($_POST['email'])) {	  $email = $_POST['email'];	  	  if($email=='') {	  	$content['error_msg'] = 'Please provide your email address';	  } elseif(!valid_email($email)) {	  	$content['error_msg'] = 'Please provide a valid email address';	  }	  	  if($email!='' && valid_email($email)) {
		  $user = new User();
		  $user = $user->retrieve_one('email = ?',$email);		  		  if($user) {		  	// email password		  	$hash = Hash::generate_hash($user->get('UserID'),true);
		  	Email::prepare_reset_password_email($user->get('Email'),$hash,$user->get('UserID'));		  			  	$content['success_msg'] = 'Instructions on how to reset your password has been sent to '.$user->get('Email');		  } else {		  	$content['error_msg'] = 'You do not have an account with us. Click <a href="/user/register">here</a> to register a free account with us now';		  }	  }  }	  $body = View::do_fetch(VIEW_PATH.'user/forgot_password.php', $content);  $data['page_title'] = 'TourPackages.com.sg | Forgot Password';
  $data['meta_description'] = 'TourPackages.com.sg | Forgot Password';    $view = new View(VIEW_PATH.'layouts/layout.php', $data);  $view->add('body',$body);  $view->dump();       }